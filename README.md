# Presentation

## Use case
The present files are a small executable dedicated to systematically profiling the units and wrappers created by the "Flop2Dyn" project. This serves to evalute the timing metrics required for both accurate unit selection and buffer placement in the Dynamatic project. It also allows for the generation of units appropriate for usage inside Dynamatic.

## Structure/Usage

### Profiling
The current strict requirement of running the generation on Debian/ubuntu means that no automatic pipeline from generation to profiling could be convenient. However, the user must simply replace the content of the ./generated_units by those generated by the Flop2Dyn project as per his setup.
The ./scripts directory contains all executables. profiler_executable.sh is the main script, which will for every file in the generated_units directory, run an appropriate vivado simulation, and store the results in ./results.
Said results are stored in two formats :an easy-to-read and parse .csv summary of the core values, as well as the raw vivado result outputs if detailed information is required.
FInally, grapher.py is a python script designed to read the result csv and generate a series of graphs of the "real" frequency (ie clock frequency corrected for slack) as a function of either the clock frequency or the used ressources.

### Generating FloPoCo files

Once profiling is complete, simply run "merge_and_update_ops.sh" from the scripts directory in order to generate, into the operators_&_wrappers_vhd directory, wrappers and ip cores ready for use in dynamatic. Likewise, run component_json_generator.sh to update component_json based off of the contents of the "base_component.json" provided : the updates will done directly on the file.

**Important note:** the wrappers are standalone, and can be used to replace the wrappers entirely. Likewise, the new component.json can also replace the extant one, with the caveat that this system only changes the delay/latency values, and does not interact with the rest. Therefore please replace base_component.json with an up-to-date version before proceeding. Finally, the flopoco_ip_cores.vhd is not standalone, and should instead be appended to a base version. This is beacause this exectuable has no way of knowing what other cores are used by cores outside of this floating point operator framework. It may be wise to eventually seperate out (in Dynamatic) a "base" file for ops outside of this framework, which would be left untouched, from a file that would be replaced wholesale by this one. 

# NDLR/TODO:
-Need to do something to prevent vivado dumping all the backup and log clutter into scripts. Gitignore doesn't prevent this on the user end. Maybe add some systematic rm's to the script? Or find some setting to dump them to some dedicated folder.


